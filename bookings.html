<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
<meta charset="UTF-8">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª | Ù‚ØµØ± Ø§Ù„Ù…Ø§Ø³Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">

<style>

body.dark{
background:#0f172a;
color:white;
}

body.light{
background:#f4f6f9;
color:#222;
}

.card-custom{
background:#1e293b;
border-radius:15px;
box-shadow:0 10px 25px rgba(0,0,0,.4);
}

body.light .card-custom{
background:white;
color:black;
}

.btn-gold{
background:linear-gradient(45deg,gold,orange);
border:none;
color:black;
font-weight:bold;
}

.table thead{
background:#111;
color:gold;
}

body.light .table thead{
background:#eee;
color:#333;
}

input.form-control, select.form-control{
background:#111;
color:white;
border:1px solid #333;
}

body.light input.form-control,
body.light select.form-control{
background:white;
color:black;
}

.loader{
position:fixed;
width:100%;
height:100%;
background:black;
display:flex;
justify-content:center;
align-items:center;
z-index:2000;
}

.loader img{
width:90px;
animation:spin 2s linear infinite;
}

@keyframes spin{
100%{transform:rotate(360deg);}
}

</style>
</head>

<body class="dark">

<!-- Loader -->
<div class="loader" id="loader">
<img src="assets/img/diamond.png">
</div>

<!-- HEADER -->
<div class="header">
<button class="toggle-btn" onclick="toggleSidebar()">â˜°</button>
<h4>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h4>
<div>
<button onclick="toggleMode()" class="btn btn-sm btn-warning">ğŸŒ™ / â˜€</button>
</div>
</div>

<!-- Overlay -->
<div class="overlay" id="overlay" onclick="closeSidebar()"></div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
<a href="index.html">ğŸ  Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
<a href="clients.html">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a>
<a href="bookings.html" class="active-link">ğŸ“… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</a>
<a href="payments.html">ğŸ’° Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</a>
<a href="reports.html">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
</div>

<!-- MAIN -->
<div class="main">

<!-- FORM -->
<div class="card card-custom p-4 mb-4">

<form id="bookingForm" class="row g-3">

<div class="col-md-4">
<label class="form-label">Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
<select id="clientSelect" class="form-control" required></select>
</div>

<div class="col-md-3">
<label class="form-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù‚Ø¯</label>
<input type="number" id="total" class="form-control" required>
</div>

<div class="col-md-3">
<label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©</label>
<input type="date" id="date" class="form-control" required>
</div>

<div class="col-md-2 d-flex align-items-end">
<button class="btn btn-gold w-100">Ø­ÙØ¸</button>
</div>

</form>

</div>

<!-- TABLE -->
<div class="card card-custom p-4">

<table class="table table-bordered text-center align-middle">
<thead>
<tr>
<th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
<th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
<th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="bookingTable"></tbody>
</table>

</div>

</div>

<script src="app.js"></script>

<script>
let clients = JSON.parse(localStorage.getItem("clients")) || [];
let bookings = JSON.parse(localStorage.getItem("bookings")) || [];
let payments = JSON.parse(localStorage.getItem("payments")) || [];

function save(){
localStorage.setItem("bookings",JSON.stringify(bookings));
}

function id(){
return Date.now();
}

function remaining(bookingId){
let booking=bookings.find(b=>b.id==bookingId);
let paid=payments
.filter(p=>p.bookingId==bookingId)
.reduce((s,p)=>s+Number(p.amount),0);
return booking.total-paid;
}

function loadClients(){
let select=document.getElementById("clientSelect");
select.innerHTML="";
clients.forEach(c=>{
select.innerHTML+=`<option value="${c.id}">${c.name}</option>`;
});
}

function renderBookings(){
let table=document.getElementById("bookingTable");
table.innerHTML="";

bookings.forEach(b=>{
let client=clients.find(c=>c.id==b.clientId);

table.innerHTML+=`
<tr>
<td>${client?.name || 'â€”'}</td>
<td>${b.total} Ø±ÙŠØ§Ù„</td>
<td>${b.date}</td>
<td class="${remaining(b.id)>0?'text-danger fw-bold':'text-success fw-bold'}">
${remaining(b.id)}
</td>
<td>
<button class="btn btn-sm btn-danger"
onclick="deleteBooking(${b.id})">ğŸ—‘</button>
</td>
</tr>`;
});
}

function deleteBooking(bookingId){
bookings=bookings.filter(b=>b.id!=bookingId);
save();
renderBookings();
}

document.getElementById("bookingForm").addEventListener("submit",function(e){
e.preventDefault();

bookings.push({
id:id(),
clientId:document.getElementById("clientSelect").value,
total:Number(document.getElementById("total").value),
date:document.getElementById("date").value
});

save();
this.reset();
renderBookings();
});

function toggleMode(){
if(document.body.classList.contains("dark")){
document.body.classList.remove("dark");
document.body.classList.add("light");
localStorage.setItem("theme","light");
}else{
document.body.classList.remove("light");
document.body.classList.add("dark");
localStorage.setItem("theme","dark");
}
}

window.onload=function(){
document.getElementById("loader").style.display="none";

let savedTheme=localStorage.getItem("theme")||"dark";
document.body.classList.add(savedTheme);

loadClients();
renderBookings();
}
</script>

</body>
</html>
