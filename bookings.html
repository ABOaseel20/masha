<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª | Ù‚ØµØ± Ø§Ù„Ù…Ø§Ø³Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Ø±Ø¨Ø· Ù…Ù„Ù Ø§Ù„Ø³ØªØ§ÙŠÙ„ -->
<link rel="stylesheet" href="assets/css/style.css">

</head>
<body>

<h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h2>

<form id="bookingForm">

<select id="clientSelect" required>
<option value="">Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„</option>
</select>

<input type="number" id="total" placeholder="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù‚Ø¯" required>

<input type="date" id="date" required>

<button type="submit">Ø­ÙØ¸ Ø§Ù„Ø­Ø¬Ø²</button>

</form>

<br><br>

<table border="1" width="100%" cellpadding="10">

<thead>
<tr>
<th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
<th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø­Ø°Ù</th>
</tr>
</thead>

<tbody id="bookingTable"></tbody>

</table>

<script>

let clients = JSON.parse(localStorage.getItem("clients")) || [];
let bookings = JSON.parse(localStorage.getItem("bookings")) || [];

/* ØªÙ†Ø¸ÙŠÙ Ø£ÙŠ Ø­Ø¬Ø² Ù…Ø±ØªØ¨Ø· Ø¨Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ */
bookings = bookings.filter(b =>
clients.some(c => Number(c.id) === Number(b.clientId))
);

localStorage.setItem("bookings", JSON.stringify(bookings));

function saveBookings(){
localStorage.setItem("bookings", JSON.stringify(bookings));
}

function loadClients(){
let select = document.getElementById("clientSelect");
select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„</option>';

clients.forEach(c=>{
select.innerHTML += `
<option value="${Number(c.id)}">
${c.name}
</option>`;
});
}

function renderBookings(){
let table = document.getElementById("bookingTable");
table.innerHTML = "";

bookings.forEach(b=>{
let client = clients.find(c =>
Number(c.id) === Number(b.clientId)
);

table.innerHTML += `
<tr>
<td>${client ? client.name : "Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"}</td>
<td>${b.total} Ø±ÙŠØ§Ù„</td>
<td>${b.date}</td>
<td align="center">
<button onclick="deleteBooking(${b.id})"
style="background:red;color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;">
ğŸ—‘ Ø­Ø°Ù
</button>
</td>
</tr>`;
});
}

function deleteBooking(id){
bookings = bookings.filter(b =>
Number(b.id) !== Number(id)
);
saveBookings();
renderBookings();
}

document.getElementById("bookingForm")
.addEventListener("submit", function(e){

e.preventDefault();

let clientId = document.getElementById("clientSelect").value;

if(!clientId){
alert("Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹");
return;
}

bookings.push({
id: Date.now(),
clientId: Number(clientId),
total: Number(document.getElementById("total").value),
date: document.getElementById("date").value
});

saveBookings();
this.reset();
renderBookings();

});

loadClients();
renderBookings();

</script>

</body>
</html>
