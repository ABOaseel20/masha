<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
margin:0;
font-family:Arial, sans-serif;
transition:.3s;
}

body.light{
background:#f5f1ea;
color:#3e2723;
}

body.dark{
background:#1e1e1e;
color:white;
}

/* ===== HEADER ===== */
.header{
height:60px;
background:#5d4037;
color:white;
display:flex;
align-items:center;
justify-content:space-between;
padding:0 20px;
position:fixed;
top:0;
right:0;
left:0;
z-index:1000;
}

.toggle-btn{
background:gold;
border:none;
padding:5px 10px;
cursor:pointer;
}

/* ===== SIDEBAR ===== */
.sidebar{
position:fixed;
top:60px;
right:-250px;
width:250px;
height:100%;
background:#3e2723;
color:white;
padding:20px;
transition:.3s;
}

.sidebar.active{
right:0;
}

.sidebar a{
display:block;
color:#d7ccc8;
text-decoration:none;
margin-bottom:10px;
}

.sidebar a:hover{
background:#5d4037;
padding:5px;
border-radius:4px;
}

/* ===== OVERLAY ===== */
.overlay{
position:fixed;
top:60px;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,.5);
display:none;
}

.overlay.show{
display:block;
}

/* ===== MAIN ===== */
.main{
margin-top:70px;
padding:20px;
}

/* ===== TABLE & FORM ===== */
form{
display:flex;
gap:10px;
flex-wrap:wrap;
margin-bottom:20px;
}

select,input{
padding:6px;
border:1px solid #ccc;
border-radius:4px;
}

button{
padding:6px 12px;
border:none;
border-radius:4px;
cursor:pointer;
}

.add-btn{
background:#6d4c41;
color:white;
}

.add-btn:hover{
background:#4e342e;
}

table{
width:100%;
border-collapse:collapse;
background:white;
color:black;
}

th{
background:#5d4037;
color:white;
padding:8px;
}

td{
padding:8px;
text-align:center;
}

tr:nth-child(even){
background:#f1e6dc;
}

.delete-btn{
background:red;
color:white;
padding:4px 10px;
}

.mode-btn{
background:#ffcc00;
}
</style>

</head>
<body class="light">

<!-- HEADER -->
<div class="header">
<button class="toggle-btn" onclick="toggleSidebar()">â˜°</button>
<h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h3>
<button class="mode-btn" onclick="toggleMode()">ğŸŒ™ / â˜€</button>
</div>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
<a href="#">ğŸ  Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
<a href="#">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a>
<a href="#">ğŸ“… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</a>
<a href="#">ğŸ’° Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</a>
<a href="#">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
</div>

<!-- OVERLAY -->
<div class="overlay" id="overlay" onclick="closeSidebar()"></div>

<!-- MAIN -->
<div class="main">

<form id="paymentForm">

<select id="bookingSelect" required>
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø¬Ø²</option>
</select>

<input type="number" id="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" required>

<input type="date" id="paymentDate" required>

<button type="submit" class="add-btn">Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø©</button>

</form>

<table>
<thead>
<tr>
<th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
<th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
<th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="paymentTable"></tbody>
</table>

</div>

<script>

let clients = JSON.parse(localStorage.getItem("clients")) || [];
let bookings = JSON.parse(localStorage.getItem("bookings")) || [];
let payments = JSON.parse(localStorage.getItem("payments")) || [];

function toggleSidebar(){
sidebar.classList.toggle("active");
overlay.classList.toggle("show");
}

function closeSidebar(){
sidebar.classList.remove("active");
overlay.classList.remove("show");
}

function toggleMode(){
document.body.classList.toggle("dark");
document.body.classList.toggle("light");
}

function savePayments(){
localStorage.setItem("payments", JSON.stringify(payments));
}

function calculateRemaining(bookingId){
let booking = bookings.find(b =>
Number(b.id) === Number(bookingId)
);

if(!booking) return 0;

let totalPaid = payments
.filter(p => Number(p.bookingId) === Number(bookingId))
.reduce((sum,p)=> sum + Number(p.amount),0);

return booking.total - totalPaid;
}

function loadBookings(){
bookingSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø¬Ø²</option>';

bookings.forEach(b=>{
let client = clients.find(c =>
Number(c.id) === Number(b.clientId)
);

bookingSelect.innerHTML += `
<option value="${Number(b.id)}">
${client ? client.name : "Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"} - ${b.date}
</option>`;
});
}

function renderPayments(){
paymentTable.innerHTML = "";

payments.forEach(p=>{
let booking = bookings.find(b =>
Number(b.id) === Number(p.bookingId)
);

let client = booking
? clients.find(c => Number(c.id) === Number(booking.clientId))
: null;

let remaining = calculateRemaining(p.bookingId);

paymentTable.innerHTML += `
<tr>
<td>${client ? client.name : "ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"}</td>
<td>${p.amount} Ø±ÙŠØ§Ù„</td>
<td>${p.date}</td>
<td>${remaining} Ø±ÙŠØ§Ù„</td>
<td>
<button class="delete-btn" onclick="deletePayment(${p.id})">
ğŸ—‘
</button>
</td>
</tr>`;
});
}

function deletePayment(id){
payments = payments.filter(p =>
Number(p.id) !== Number(id)
);
savePayments();
renderPayments();
}

paymentForm.addEventListener("submit",function(e){

e.preventDefault();

let bookingId = bookingSelect.value;

if(!bookingId){
alert("Ø§Ø®ØªØ± Ø­Ø¬Ø² Ø£ÙˆÙ„Ø§Ù‹");
return;
}

let amountValue = Number(amount.value);
let remaining = calculateRemaining(bookingId);

if(amountValue > remaining){
alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¯ÙØ¹ Ù…Ø¨Ù„Øº Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ");
return;
}

payments.push({
id: Date.now(),
bookingId: Number(bookingId),
amount: amountValue,
date: paymentDate.value
});

savePayments();
this.reset();
renderPayments();

});

loadBookings();
renderPayments();

</script>

</body>
</html>
