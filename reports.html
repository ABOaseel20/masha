<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ø¯ÙØ¹Ø§Øª</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
</head>

<body class="dark">

    <div class="loader">
        <img src="assets/img/diamond.png">
    </div>

    <div class="d-flex">

        <div class="sidebar p-3">
            <h4 class="text-warning text-center">ğŸ’ Ø§Ù„Ù…Ø§Ø³Ø©</h4>
            <a href="index.html">ğŸ  Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
            <a href="clients.html">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a>
            <a href="bookings.html">ğŸ“… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</a>
            <a href="payments.html">ğŸ’° Ø§Ù„Ø¯ÙØ¹Ø§Øª</a>
            <a href="reports.html">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
            <button onclick="toggleMode()" class="btn btn-sm btn-warning mt-3">ğŸŒ™ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹</button>
        </div>

        <div class="flex-fill p-4">

            <button onclick="toggleSidebar()" class="btn btn-outline-warning mb-3">â˜°</button>

            <h3 class="text-warning mb-4">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª</h3>

            <form id="paymentForm" class="row g-2">

                <div class="col-md-4">
                    <select id="bookingSelect" class="form-control" required></select>
                </div>

                <div class="col-md-3">
                    <input type="number" id="amount" class="form-control" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" required>
                </div>

                <div class="col-md-3">
                    <input type="date" id="paymentDate" class="form-control" required>
                </div>

                <div class="col-md-2">
                    <button class="btn btn-success w-100">Ø­ÙØ¸</button>
                </div>

            </form>

            <hr>

            <table class="table table-dark table-bordered text-center">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                    </tr>
                </thead>
                <tbody id="paymentTable"></tbody>
            </table>

        </div>
    </div>

    <script src="assets/js/app.js"></script>
    <script>
        function loadBookings() {
            let select = document.getElementById("bookingSelect");
            select.innerHTML = "";
            bookings.forEach(b => {
                let client = clients.find(c => c.id == b.clientId);
                select.innerHTML += `<option value="${b.id}">
${client?.name} - ${b.date}
</option>`;
            });
        }

        function renderPayments() {
            let table = document.getElementById("paymentTable");
            table.innerHTML = "";
            payments.forEach(p => {
                let booking = bookings.find(b => b.id == p.bookingId);
                let client = clients.find(c => c.id == booking.clientId);
                table.innerHTML += `
<tr>
<td>${client?.name}</td>
<td>${p.amount}</td>
<td>${p.date}</td>
<td>${remaining(p.bookingId)}</td>
</tr>`;
            });
        }

        document.getElementById("paymentForm").addEventListener("submit", function(e) {
            e.preventDefault();

            payments.push({
                id: id(),
                bookingId: document.getElementById("bookingSelect").value,
                amount: Number(document.getElementById("amount").value),
                date: document.getElementById("paymentDate").value
            });

            save();
            this.reset();
            renderPayments();
        });

        loadBookings();
        renderPayments();
    </script>

</body>

</html>