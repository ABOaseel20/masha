<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
<meta charset="UTF-8">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª | Ù‚ØµØ± Ø§Ù„Ù…Ø§Ø³Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
<link href="assets/css/style.css" rel="stylesheet">
</head>

<body class="dark">

<!-- ===== HEADER ===== -->
<div class="header">
<button class="toggle-btn" onclick="toggleSidebar()">â˜°</button>
<h4>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ¹Ø§Øª</h4>
<div>
<button onclick="toggleMode()" class="btn btn-sm btn-warning">ğŸŒ™ / â˜€</button>
</div>
</div>

<!-- ===== Overlay ===== -->
<div class="overlay" id="overlay" onclick="closeSidebar()"></div>

<!-- ===== Sidebar ===== -->
<div class="sidebar" id="sidebar">
<a href="index.html">ğŸ  Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
<a href="clients.html">ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a>
<a href="bookings.html">ğŸ“… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</a>
<a href="payments.html" class="active-link">ğŸ’° Ø§Ù„Ø¯ÙØ¹Ø§Øª</a>
<a href="reports.html">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
</div>

<!-- ===== Main ===== -->
<div class="main">

<!-- ===== Form ===== -->
<div class="card-custom mb-4">

<form id="paymentForm" class="row g-3">

<div class="col-md-4">
<label class="form-label">Ø§Ù„Ø­Ø¬Ø²</label>
<select id="bookingSelect" class="form-control" required></select>
</div>

<div class="col-md-3">
<label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº</label>
<input type="number" id="amount" class="form-control" required>
</div>

<div class="col-md-3">
<label class="form-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
<input type="date" id="paymentDate" class="form-control" required>
</div>

<div class="col-md-2 d-flex align-items-end">
<button class="btn btn-success w-100">Ø­ÙØ¸</button>
</div>

</form>

</div>

<!-- ===== Table ===== -->
<div class="card-custom">

<table class="table table-bordered text-center align-middle">
<thead class="table-dark">
<tr>
<th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
<th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
</tr>
</thead>
<tbody id="paymentTable"></tbody>
</table>

</div>

</div>

<script src="assets/js/app.js"></script>

<script>

/* ===== Page Specific Logic ===== */

let clients = JSON.parse(localStorage.getItem("clients")) || [];
let bookings = JSON.parse(localStorage.getItem("bookings")) || [];
let payments = JSON.parse(localStorage.getItem("payments")) || [];

function loadBookings(){
let select=document.getElementById("bookingSelect");
select.innerHTML="";

bookings.forEach(b=>{
let client=clients.find(c=>c.id==b.clientId);
select.innerHTML+=`
<option value="${b.id}">
${client?.name || "-"} - ${b.date}
</option>`;
});
}

function remaining(bookingId){
let booking=bookings.find(b=>b.id==bookingId);
let paid=payments
.filter(p=>p.bookingId==bookingId)
.reduce((s,p)=>s+Number(p.amount),0);

return booking ? booking.total - paid : 0;
}

function renderPayments(){
let table=document.getElementById("paymentTable");
table.innerHTML="";

payments.forEach(p=>{
let booking=bookings.find(b=>b.id==p.bookingId);
let client=clients.find(c=>c.id==booking?.clientId);

table.innerHTML+=`
<tr>
<td>${client?.name || "-"}</td>
<td>${p.amount} Ø±ÙŠØ§Ù„</td>
<td>${p.date}</td>
<td class="${remaining(p.bookingId)>0?'text-danger fw-bold':'text-success fw-bold'}">
${remaining(p.bookingId)}
</td>
</tr>`;
});
}

document.getElementById("paymentForm").addEventListener("submit",function(e){
e.preventDefault();

payments.push({
id: Date.now(),
bookingId: document.getElementById("bookingSelect").value,
amount: Number(document.getElementById("amount").value),
date: document.getElementById("paymentDate").value
});

localStorage.setItem("payments",JSON.stringify(payments));
this.reset();
renderPayments();
});

/* ===== Init ===== */
window.onload=function(){
let savedTheme=localStorage.getItem("theme") || "dark";
document.body.classList.add(savedTheme);
loadBookings();
renderPayments();
}

</script>

</body>
</html>
